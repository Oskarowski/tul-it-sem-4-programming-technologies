CREATE TABLE Users (
	ID UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	FirstName NVARCHAR(255) NOT NULL,
    LastName NVARCHAR(255) NOT NULL,
	Email NVARCHAR(255) NOT NULL,
	Balance DECIMAL(18, 2) NOT NULL,
    PhoneNumber NVARCHAR(255) NOT NULL,
);

CREATE TABLE Products (
    ID UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
    Name NVARCHAR(255) NOT NULL,
    Price DECIMAL(18, 2) NOT NULL,
    CreatedAt DATETIME NOT NULL DEFAULT GETDATE()
);

CREATE TABLE States (
	ID UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	ProductID UNIQUEIDENTIFIER NOT NULL,
    Quantity INT NOT NULL,
    LastUpdate DATETIME NOT NULL DEFAULT GETDATE(),
    FOREIGN KEY (ProductID) REFERENCES Products(ID)
);

CREATE TABLE Events (
	ID UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	UserID UNIQUEIDENTIFIER NOT NULL,
	StateID UNIQUEIDENTIFIER NOT NULL,
	CreatedAt DATETIME NOT NULL DEFAULT GETDATE(),
    EventType NVARCHAR(255) NOT NULL CHECK (EventType IN ('Borrow', 'Return', 'Delivery')),
    FOREIGN KEY (UserID) REFERENCES Users(ID),
    FOREIGN KEY (StateID) REFERENCES States(ID)
);

CREATE TABLE Books (
    ProductID UNIQUEIDENTIFIER PRIMARY KEY,
    Author NVARCHAR(255) NOT NULL,
    Publisher NVARCHAR(255) NOT NULL,
    Pages INT NOT NULL,
    PublicationDate DATE NOT NULL,
    FOREIGN KEY (ProductID) REFERENCES Products(ID)
);